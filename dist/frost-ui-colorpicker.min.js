!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@fr0st/ui"),require("@fr0st/color"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/color","@fr0st/query"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).UI=t.UI||{},t.UI,t.Color,t.fQuery)}(this,(function(t,e,i,o){"use strict";function s(t){if(!t)return null;if(t instanceof i)return t;try{return i.fromString(t)}catch(t){return null}}class n extends e.BaseComponent{constructor(t,e){super(t,e);const n=o.getValue(this._node);"auto"===this._options.format&&(this._options.format=function(t){if(!t)return null;if("#"===t.substring(0,1))return"hex";const e=t.substring(0,3);return["rgb","hsl"].includes(e)?e:null}(n)),this._options.defaultColor&&(this._defaultColor=s(this._options.defaultColor)),this._defaultColor||(this._defaultColor=new i),this._color=s(n);let a=!0;this._color||(this._color=this._defaultColor,a=!1),this._options.inline?this._options.modal=!1:!this._options.modal&&this._options.mobileModal&&(this._options.modal=/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent)),this._options.modal&&(this._options.horizontal=!0);const r=o.closest(this._node,".input-group").shift();if(r&&(this._inputGroupColor=o.findOne(".input-group-color",r)),a||n&&!this._options.keepInvalid){const t=this._getString(this._color);o.setValue(this._node,t)}this._render(),this._events(),this._options.modal&&(this._renderModal(),this._eventsModal()),this._updateAttributes(),this._refresh(),this._refreshDisabled()}disable(){o.setAttribute(this._node,{disabled:!0}),this._refreshDisabled()}dispose(){this._popper&&(this._popper.dispose(),this._popper=null),this._modal&&(e.Modal.init(this._modal).dispose(),this._modal=null),o.removeEvent(this._node,"change.ui.colorpicker"),o.removeEvent(this._node,"click.ui.colorpicker"),o.removeEvent(this._node,"focus.ui.colorpicker"),o.removeEvent(this._node,"blur.ui.colorpicker"),o.removeEvent(this._node,"keydown.ui.colorpicker"),o.removeEvent(this._node,"keyup.ui.colorpicker"),this._inputGroupColor&&(o.removeEvent(this._inputGroupColor,"mousedown.ui.colorpicker"),o.removeEvent(this._inputGroupColor,"click.ui.colorpicker")),o.remove(this._menuNode),this._color=null,this._defaultColor=null,this._inputGroupColor=null,this._menuNode=null,this._container=null,this._saturation=null,this._saturationGuide=null,this._hue=null,this._hueGuide=null,this._alpha=null,this._alphaColor=null,this._alphaGuide=null,this._preview=null,this._previewColor=null,this._values=null,this._dateOptions=null,this._modal=null,this._setBtn=null,super.dispose()}enable(){o.removeAttribute(this._node,"disabled"),this._refreshDisabled()}getColor(){return this._color}hide(){this._options.inline||(this._options.modal?e.Modal.init(this._modal).hide():o.isConnected(this._menuNode)&&!o.getDataset(this._menuNode,"uiAnimating")&&o.triggerOne(this._node,"hide.ui.colorpicker")&&(o.setDataset(this._menuNode,{uiAnimating:"out"}),o.fadeOut(this._menuNode,{duration:this._options.duration}).then((t=>{this._popper.dispose(),this._popper=null,o.detach(this._menuNode),o.removeDataset(this._menuNode,"uiAnimating"),o.triggerEvent(this._node,"hidden.ui.colorpicker")})).catch((t=>{"out"===o.getDataset(this._menuNode,"uiAnimating")&&o.removeDataset(this._menuNode,"uiAnimating")}))))}setColor(t){(t=s(t))&&(this._options.alpha||(t=t.setAlpha(1)),this._setColor(t))}show(){if(!this._options.inline&&!o.isConnected(this._menuNode)&&this._isEditable()){if(this._options.modal){this._options.appendTo?o.append(this._options.appendTo,this._modal):o.after(this._node,this._modal);const t=e.Modal.init(this._modal);return this._activeTarget&&(t._activeTarget=this._activeTarget),void t.show()}!o.getDataset(this._menuNode,"uiAnimating")&&o.triggerOne(this._node,"show.ui.colorpicker")&&(o.setDataset(this._menuNode,{uiAnimating:"in"}),this._options.appendTo?o.append(this._options.appendTo,this._menuNode):o.after(this._node,this._menuNode),this._popper=new e.Popper(this._menuNode,{reference:this._node,placement:this._options.placement,position:this._options.position,fixed:this._options.fixed,spacing:this._options.spacing,minContact:this._options.minContact}),o.fadeIn(this._menuNode,{duration:this._options.duration}).then((t=>{o.removeDataset(this._menuNode,"uiAnimating"),o.triggerEvent(this._node,"shown.ui.colorpicker")})).catch((t=>{"in"===o.getDataset(this._menuNode,"uiAnimating")&&o.removeDataset(this._menuNode,"uiAnimating")})))}}toggle(){o.isConnected(this._menuNode)?this.hide():this.show()}update(){this._popper&&this._popper.update()}}n.defaults={format:"auto",defaultColor:null,alpha:!0,inline:!1,horizontal:!1,keepInvalid:!1,ignoreReadonly:!1,modal:!1,mobileModal:!0,duration:100,appendTo:null,placement:"bottom",position:"start",fixed:!1,spacing:0,minContact:!1},n.classes={alpha:"colorpicker-alpha flex-grow-1",alphaColor:"colorpicker-alpha-color",container:"d-flex justify-content-between",containerHorizontal:"flex-column",disabled:"colorpicker-disabled",guide:"colorpicker-guide",hue:"colorpicker-hue flex-grow-1",menu:"colorpicker",menuHorizontal:"colorpicker-horizontal",menuInline:"colorpicker-inline",menuPadding:"p-2",modal:"modal",modalBody:"modal-body",modalBtnContainer:"text-end mt-4",modalBtnPrimary:"btn btn-primary ripple ms-2",modalBtnSecondary:"btn btn-secondary ripple ms-2",modalContent:"modal-content",modalDialog:"modal-dialog modal-sm",preview:"colorpicker-bar colorpicker-preview mt-2",saturation:"colorpicker-saturation",spacingHorizontal:"mt-2",spacingVertical:"me-2"},n.parseColor=s;const a=n.prototype;a._events=function(){o.addEvent(this._menuNode,"contextmenu.ui.colorpicker",(t=>{t.preventDefault()}));const t=o.mouseDragFactory((t=>{if(t.button)return!1}),(t=>{const i=e.getPosition(t);this._updateSaturation(i.x,i.y)}));o.addEvent(this._saturation,"mousedown.ui.colorpicker touchstart.ui.colorpicker",t),o.addEvent(this._saturation,"click.ui.colorpicker",(t=>{if(t.button)return!1;const i=e.getPosition(t);this._updateSaturation(i.x,i.y)}));const i=o.mouseDragFactory((t=>{if(t.button)return!1}),(t=>{const i=e.getPosition(t);this._updateHue(i.x,i.y)}));if(o.addEvent(this._hue,"mousedown.ui.colorpicker touchstart.ui.colorpicker",i),o.addEvent(this._hue,"click.ui.colorpicker",(t=>{if(t.button)return!1;const i=e.getPosition(t);this._updateHue(i.x,i.y)})),this._options.alpha){const t=t=>{if(t.button)return!1},i=t=>{const i=e.getPosition(t);this._updateAlpha(i.x,i.y)},s=o.mouseDragFactory(t,i);o.addEvent(this._alpha,"mousedown.ui.colorpicker touchstart.ui.colorpicker",s),o.addEvent(this._alpha,"click.ui.colorpicker",(t=>{if(t.button)return!1;const i=e.getPosition(t);this._updateAlpha(i.x,i.y)}))}o.addEvent(this._node,"change.ui.colorpicker",(t=>{if(t.skipUpdate)return;const e=o.getValue(this._node),i=s(e);i?this._setColor(i):!this._options.keepInvalid&&e?this._setColor(this._color):(this._color=this._defaultColor,this._updateAttributes(),this._refresh())})),this._options.inline||(o.addEvent(this._menuNode,"click.ui.colorpicker",(t=>{t.stopPropagation()})),o.addEvent(this._menuNode,"mousedown.ui.colorpicker",(t=>{t.preventDefault()})),o.addEvent(this._node,"click.ui.colorpicker",(t=>{"in"!==o.getDataset(this._menuNode,"uiAnimating")&&(this._options.modal?this._activeTarget=this._node:(o.stop(this._menuNode),o.removeDataset(this._menuNode,"uiAnimating")),this.show())})),this._options.modal||(o.addEvent(this._node,"focus.ui.colorpicker",(t=>{o.isSame(this._node,document.activeElement)&&(o.stop(this._menuNode),o.removeDataset(this._menuNode,"uiAnimating"),this.show())})),o.addEvent(this._node,"blur.ui.colorpicker",(t=>{o.isSame(this._node,document.activeElement)||"out"!==o.getDataset(this._menuNode,"uiAnimating")&&(o.stop(this._menuNode),o.removeDataset(this._menuNode,"uiAnimating"),this.hide())}))),o.addEvent(this._node,"keydown.ui.colorpicker",(t=>{switch(t.code){case"Enter":case"NumpadEnter":t.preventDefault(),this.toggle()}})),o.addEvent(this._node,"keyup.ui.colorpicker",(t=>{"Escape"===t.code&&o.isConnected(this._menuNode)&&(t.stopPropagation(),this.hide())})),this._inputGroupColor&&(o.addEvent(this._inputGroupColor,"mousedown.ui.colorpicker",(t=>{t.preventDefault()})),o.addEvent(this._inputGroupColor,"click.ui.colorpicker",(t=>{o.focus(this._node),this.toggle()}))))},a._eventsModal=function(){let t,e=!1;o.addEvent(this._modal,"show.ui.modal",(e=>{if(!o.triggerOne(this._node,"show.ui.colorpicker"))return!1;t=o.getValue(this._node)})),o.addEvent(this._modal,"shown.ui.modal",(t=>{o.triggerEvent(this._node,"shown.ui.colorpicker")})),o.addEvent(this._modal,"hide.ui.modal",(i=>{if(!o.triggerOne(this._node,"hide.ui.colorpicker"))return e=!1,!1;this._activeTarget=null,e||(o.setValue(this._node,t),o.triggerEvent(this._node,"change.ui.colorpicker"))})),o.addEvent(this._modal,"hidden.ui.modal",(t=>{e=!1,o.detach(this._modal),o.triggerEvent(this._node,"hidden.ui.colorpicker")})),o.addEvent(this._setBtn,"click.ui.modal",(t=>{e=!0}))},a._getString=function(t){switch(this._options.format){case"hex":return t.toHexString();case"rgb":return t.toRGBString();case"hsl":return t.toHSLString();default:return`${t}`}},a._isEditable=function(){return!o.is(this._node,":disabled")&&(this._options.ignoreReadonly||!o.is(this._node,":read-only"))},a._refresh=function(){const t=Color.fromHSV(this._values.hue,100,100);o.setStyle(this._saturation,{backgroundColor:t}),o.setStyle(this._saturationGuide,{top:100-this._values.brightness+"%",left:`${this._values.saturation}%`});const e=100-this._values.hue/3.6+"%";if(this._options.horizontal?o.setStyle(this._hueGuide,{left:e}):o.setStyle(this._hueGuide,{top:e}),this._options.alpha){const t=Color.fromHSV(this._values.hue,this._values.saturation,this._values.brightness),e=this._options.horizontal?"to right,":"";o.setStyle(this._alphaColor,{background:`linear-gradient(${e}${t} 0%, transparent 100%)`});const i=100-100*this._values.alpha+"%";this._options.horizontal?o.setStyle(this._alphaGuide,{left:i}):o.setStyle(this._alphaGuide,{top:i})}o.setStyle(this._previewColor,{backgroundColor:this._color}),this._inputGroupColor&&o.setStyle(this._inputGroupColor,{backgroundColor:this._color})},a._refreshDisabled=function(){this._native||(o.is(this._node,":disabled")?o.addClass(this._menuNode,this.constructor.classes.disabled):o.removeClass(this._menuNode,this.constructor.classes.disabled))},a._render=function(){this._menuNode=o.create("div",{class:this.constructor.classes.menu}),this._container=o.create("div",{class:this.constructor.classes.container}),o.append(this._menuNode,this._container),this._saturation=o.create("div",{class:this.constructor.classes.saturation}),o.append(this._container,this._saturation),this._saturationGuide=o.create("div",{class:this.constructor.classes.guide}),o.append(this._saturation,this._saturationGuide),this._hue=o.create("div",{class:this.constructor.classes.hue}),o.append(this._container,this._hue),this._hueGuide=o.create("div",{class:this.constructor.classes.guide}),o.append(this._hue,this._hueGuide),this._options.alpha&&(this._alpha=o.create("div",{class:this.constructor.classes.alpha}),o.append(this._container,this._alpha),this._alphaColor=o.create("div",{class:this.constructor.classes.alphaColor}),o.append(this._alpha,this._alphaColor),this._alphaGuide=o.create("div",{class:this.constructor.classes.guide}),o.append(this._alpha,this._alphaGuide)),this._preview=o.create("div",{class:this.constructor.classes.preview}),o.append(this._menuNode,this._preview),this._previewColor=o.create("div"),o.append(this._preview,this._previewColor),this._options.horizontal?(o.addClass(this._menuNode,this.constructor.classes.menuHorizontal),o.addClass(this._container,this.constructor.classes.containerHorizontal),o.addClass(this._hue,this.constructor.classes.spacingHorizontal),this._options.alpha&&o.addClass(this._alpha,this.constructor.classes.spacingHorizontal)):(o.addClass(this._saturation,this.constructor.classes.spacingVertical),this._options.alpha&&o.addClass(this._hue,this.constructor.classes.spacingVertical)),this._options.modal?o.addClass(this._menuNode,"colorpicker-modal"):this._options.inline?(o.addClass(this._menuNode,this.constructor.classes.menuInline),o.after(this._node,this._menuNode),o.hide(this._node)):o.addClass(this._menuNode,this.constructor.classes.menuPadding)},a._renderModal=function(){this._modal=o.create("div",{class:this.constructor.classes.modal,attributes:{tabindex:-1,role:"dialog","aria-modal":!0}});const t=o.create("div",{class:this.constructor.classes.modalDialog});o.append(this._modal,t);const e=o.create("div",{class:this.constructor.classes.modalContent});o.append(t,e);const i=o.create("div",{class:this.constructor.classes.modalBody});o.append(i,this._menuNode);const s=o.create("div",{class:this.constructor.classes.modalBtnContainer});o.append(i,s);const n=o.create("button",{class:this.constructor.classes.modalBtnSecondary,text:"Cancel",attributes:{type:"button","data-ui-dismiss":"modal"}});o.append(s,n),this._setBtn=o.create("button",{class:this.constructor.classes.modalBtnPrimary,text:"Set",attributes:{type:"button","data-ui-dismiss":"modal","data-ui-set-color":"true"}}),o.append(s,this._setBtn),o.append(e,i)},a._setColor=function(t,{updateAttributes:e=!0}={}){if(!this._isEditable())return;const i=this._color;this._color=t;const s=o.getValue(this._node),n=this._getString(t);e&&this._updateAttributes(),this._refresh(),s!==n&&(o.setValue(this._node,n),o.triggerEvent(this._node,"change.ui.colorpicker",{data:{skipUpdate:!0},detail:{old:i,new:this._color}}))},a._updateAlpha=function(t,e){const i=this._options.horizontal?o.percentX(this._alpha,t,{offset:!0}):o.percentY(this._alpha,e,{offset:!0});this._values.alpha=1-i/100,this._updateColor()},a._updateAttributes=function(){this._values={alpha:this._options.alpha?this._color.getAlpha():1,brightness:this._color.getBrightness(),hue:this._color.getHue(),saturation:this._color.getSaturation()}},a._updateColor=function(){const t=this.getColor().setAlpha(this._values.alpha).setBrightness(this._values.brightness).setHue(this._values.hue).setSaturation(this._values.saturation);this._setColor(t,!1)},a._updateHue=function(t,e){const i=this._options.horizontal?o.percentX(this._hue,t,{offset:!0}):o.percentY(this._hue,e,{offset:!0});this._values.hue=3.6*(100-i),this._updateColor()},a._updateSaturation=function(t,e){this._values.brightness=100-o.percentY(this._saturation,e,{offset:!0}),this._values.saturation=o.percentX(this._saturation,t,{offset:!0}),this._updateColor()},e.initComponent("colorpicker",n),t.ColorPicker=n}));